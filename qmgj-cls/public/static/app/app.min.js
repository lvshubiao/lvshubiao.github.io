var app = angular.module('qmgj_unlogin', ['ui.router']);
app.config(['$stateProvider','$urlRouterProvider',
	function($stateProvider,$urlRouterProvider) {
	$urlRouterProvider.otherwise('/login');
	$stateProvider.state('home',{
		url:'/home',
		templateUrl:'static/app/view/homeView.html',
		controller:'homeController'
	}).state('reg',{
		url:'/reg',
		templateUrl:'static/app/view/regView.html',
		controller:'regController'
	}).state('login',{
		url:'/login',
		templateUrl:'static/app/view/loginView.html',
		controller:'loginController'
	}).state('list',{
		url:'/list',
		templateUrl:'static/app/view/listView.html',
		controller:'listController'
	}).state('list2',{
		url:'/list/:keyword',
		templateUrl:'static/app/view/listView.html',
		controller:'listController'
	})
}])
app.filter('substr',function(){
	return function(){
		var val = arguments[0],
			start = arguments[1],
			count = arguments[2];
		if (start == undefined) {
			start = 0;
			count = val.length;
		}
		if (count == undefined) {
			start = 0;
			count = arguments[1]
		}
		return val.substr( start,count );
	}
})
app.filter('getMoon', function() {
    return function(input) {
        var curH = new Date(parseInt(input)).getHours();
        // var val = input/1000/60/60;
        var moon = '';
        if (curH > 6 && curH < 12) {
            moon = '上午好';

        } else if (curH >= 12 && curH < 14) {
            moon = '中午好';
        } else if (curH >= 14 && curH < 18) {
            moon = '下午好';
        } else if (curH > 18 && curH < 24) {
            moon = '晚上好';
        } else {
            moon = '凌晨好';
        }
        return moon;
    }

});

var app2 = angular.module('qmgj_login', ['ui.router','ui.bootstrap']);
app2.config(['$stateProvider','$urlRouterProvider',
	function($stateProvider,$urlRouterProvider) {
	$urlRouterProvider.otherwise('/vip/main');
	$stateProvider.state('home',{
		url:'/home',
		templateUrl:'static/app/view/homeView.html',
		controller:'homeController'
	}).state('vip',{
		url:'/vip',
		templateUrl:'static/app/view/vipView.html',
		controller:'vipController'
	}).state('vip.main',{
		url:'/main',
		templateUrl:'static/app/view/vip.mainView.html',
		controller:'vipMainController'
	}).state('vip.info',{
		url:'/info',
		templateUrl:'static/app/view/vip.infoView.html',
		controller:'vipInfoController'
	}).state('vip.record',{
		url:'/record',
		templateUrl:'static/app/view/vip.recordView.html',
		controller:'vipRecordController'
	}).state('list',{
		url:'/list',
		templateUrl:'static/app/view/listView.html',
		controller:'listController'
	}).state('list2',{
		url:'/list/:keyword',
		templateUrl:'static/app/view/listView.html',
		controller:'listController'
	})
}])
app2.filter('substr',function(){
	return function(){
		var val = arguments[0],
			start = arguments[1],
			count = arguments[2];
		if (start == undefined) {
			start = 0;
			count = val.length;
		}
		if (count == undefined) {
			start = 0;
			count = arguments[1]
		}
		return val.substr( start,count );
	}
})
app2.filter('getMoon', function() {
    return function(input) {
        var curH = new Date(parseInt(input)).getHours();
        var moon = '';
        if (curH > 6 && curH < 12) {
            moon = '上午好';

        } else if (curH >= 12 && curH < 14) {
            moon = '中午好';
        } else if (curH >= 14 && curH < 18) {
            moon = '下午好';
        } else if (curH > 18 && curH < 24) {
            moon = '晚上好';
        } else {
            moon = '凌晨好';
        }
        return moon;
    }

});
app.controller('homeController', ['$scope', '$http', '$interval', myHomeController])
app2.controller('homeController', ['$scope', '$http', '$interval', myHomeController])

function myHomeController($scope, $http, $interval) {
    $scope.hotNav = ['', '微电影', '电视剧', '话剧', '电影',
        '戏曲', '书画', '相声', '戏剧', '音乐剧'
    ];
    var homePage = {
        init: function() {
            var that = this;
            $http({
                url: '/IndexInfo',
                method: 'get'
            }).then(function(res) {
                if (res.data.resultCode == '0000') {
                    console.log(res);
                    // 处理轮播
                    that.dealSlide(res.data.result.slides);
                    // 处理热门项目
                    that.dealHot(res.data.result.hot);
                    // 处理卫视主推
                    that.dealTV(res.data.result.new);
                    // 处理合作单位
                    that.dealTeam(res.data.result.unit);
                } else {
                    alert(res.data.resultMsg)
                }

            })
        },
        dealSlide: function(slideData) {
            $scope.slideData = slideData;
            $scope.showIndex = 0;
            function doMove() {
                $scope.showIndex++;
                if ($scope.showIndex == $scope.slideData.length) {
                    $scope.showIndex = 0
                }
            }
            var inter = $interval(doMove, 1500);
            $scope.pauseSlide = function(index) {
                $scope.showIndex = index;
                $interval.cancel(inter);
            }
            $scope.playSlide = function(index) {
                $scope.showIndex = index;
                inter = $interval(doMove, 1500);
            }
        },
        dealHot: function(hotData) {
            $scope.hotData = hotData;
            $scope.hotIndex = 0;
            $scope.showHotItem = function(index) {
                $scope.hotIndex = index;
            }
        },
        dealTV: function(tvData) {
            $scope.tvData = tvData;
        },
        dealTeam: function(teamData) {
            $scope.teamData = teamData;
        }
    }
    homePage.init();
}

app.controller('listController', ['$scope', '$http','$stateParams', myListcontroller])
app2.controller('listController', ['$scope', '$http','$stateParams', myListcontroller])

function myListcontroller($scope, $http,$stateParams) {
	$scope.arr = ['全部','微电影','电视剧','话剧','电影','戏曲','书画','相声','戏剧','音乐剧','其它'];
    var list = {
        init: function() {
            var that = this;
            $scope.cid = 0;
            $scope.status = 0;
            $scope.timeStatus = 0;
            $scope.count = 9;
            $scope.countAll = 0;
            $scope.maxSize = 5;
            $scope.keyword = '';
			//初始化
			if ($stateParams.keyword != undefined) {
				$scope.keyword = $stateParams.keyword;
			}
            that.events();
            that.getprolistData();
        },
        events: function() {
        	var that = this;
        	$scope.changeCid = function(index){
        		$scope.cid = index;
        		that.getprolistData();
        	}
        	$scope.changeStatus = function(index){
        		$scope.status = index;
        		that.getprolistData();
        	}
        	$scope.changeTimeStatus = function(index){
        		$scope.timeStatus = index;
        		that.getprolistData();
        	}
        	$scope.pageChanged = function(){
        		
        		that.getprolistData();
        	}
        },
        getprolistData: function() {
            $http({
                url: '/prolist',
                params: {
                    keyword: $scope.keyword,
                    cid: $scope.cid,
                    status: $scope.status, 
                    timeStatus:  $scope.timeStatus,
                    page: $scope.page,
                    count: $scope.count 
                }
            }).then(function(res){
            	if (res.data.resultCode == '0000') {
            		console.log(res);
            		var result = res.data.result;
            		$scope.countAll = result.countAll;
            		$scope.prolistData = result.list;
            	}else{
            		alert(res.data.resultMsg);
            	}
            })
        }
    }
    list.init();
}

app.controller('loginController', ['$scope', '$http','$state',
    function($scope, $http,$state) {
        $scope.loginClick = function() {
            if ($scope.myform.$valid) {
                $http({
                    url: '/user/login',
                    method: 'post',
                    data: {
                        phone: $scope.phone,
                        password: $scope.pwd
                    }
                }).then(function(res){
                	if (res.data.resultCode == '0000') {
                		alert('登陆成功');
                		location.reload();
                	}else{
                		alert(res.data.resultMsg)
                	}
                })
            }
        }
    }
])

app2.controller('logoutController', ['$scope','$rootScope','$http',
 function($scope,$rootScope,$http){
	$rootScope.userLogout = function(){
		$http({
			url:'/user/logout'
		}).then(function(res){
			if (res.data.resultCode == '0000') {
				alert('退出成功');
				location.reload();
			}
		})
	}
}])
app.controller('regController', ['$scope', '$http','$state',
    function($scope, $http,$state) {
        $scope.regClick = function() {
            if ($scope.myform.$valid && $scope.pwd2 == $scope.pwd) {
                $http({
                    url: '/user/reg',
                    method: 'post',
                    data: {
                        name:$scope.name,
                        phone:$scope.phone,
                        password:$scope.pwd,
                        passwordRepeat:$scope.pwd2
                    }
                }).then(function(res){
                	if (res.data.resultCode == '0000') {
                		alert('注册成功');
                		$state.go('login');
                	}else{
                		alert(res.data.resultMsg);
                	}
                })
            }
        }
    }
])

app.controller('searchController', ['$scope', '$http', '$state',mySearchController]);
app2.controller('searchController', ['$scope', '$http', '$state',mySearchController]);

function mySearchController($scope, $http, $state) {
	$scope.myKeyUp = function(e){
		if (e.keyCode == 13) {
			var inputVal = angular.element(e.target).val();
			$state.go('list2',{keyword:inputVal})
		}
	}
}

app2.controller('vipController', ['$scope','$http', 
	function($scope,$http){
	$http({
		url:'/user/info',
		method:'post'

	}).then(function(res){
		if (res.data.resultCode == '0000') {
			console.log(res);
			$scope.userinfo = res.data.result;
		}else{
			alert(res.data.resultMsg);
		}
	})
}])

app2.controller('vipInfoController', ['$scope', '$http',
    function($scope, $http) {
        $scope.fileNameChanged = function(e) {
            console.log(e);
        }
        $scope.cipArr = ['微电影', '电视剧', '话剧', '电影',
            '戏曲', '书画', '相声', '戏剧', '音乐剧'
        ];
        $scope.radio = function(e) {
            var ngDom = angular.element(e.target);
            ngDom.parent().children().removeClass('active');
            ngDom.addClass('active');
        }
        $scope.checkbox = function(e) {
            var ngDom = angular.element(e.target);
            ngDom.toggleClass('active');
        }
        $scope.submit = function() {
            var ngDom1 = angular.element(document.querySelectorAll('.info-radio.active'));
            console.log('性别:', ngDom1.attr('data-value'));
            var ngDom2 = angular.element(document.querySelectorAll('.info-checkbox.active'));
            var arr = [];
            for (var i = 0; i < ngDom2.length; i++) {
                arr.push(ngDom2.eq(i).attr('data-value'));
            }
            console.log('关注的圈子', arr.toString());
        }

    }
])

app2.controller('vipMainController', ['$scope','$http', 
	function($scope,$http){
	$http({
		url:'/user/pros',
		method:'get'
	}).then(function(res){
		if (res.data.resultCode == '0000') {
			console.log(res)
			$scope.procare = res.data.result.procare;
			$scope.prohot = res.data.result.prohot;
		}else{
			alert(res.data.resultMsg);
		}
	})
}])
app2.controller('vipRecordController', ['$scope', '$http',
    function($scope, $http) {
        var record = {
            init: function() {
                var that = this;
                $scope.type = 0;
                $scope.page = 1;
                $scope.count = 9;
                $scope.countAll = 0;
                $scope.maxSize = 5;
                that.events();
                that.getRecordData();
            },
            events: function() {
            	var that = this;
                $scope.changeType = function(index) {
                    $scope.type = index;
                    that.getRecordData();
                }
                $scope.pageChanged = function(){
                	that.getRecordData();
                }
            },
            getRecordData: function() {
                $http({
                    url: '/user/RecordList',
                    method: 'post',
                    data: {
                        type: $scope.type, 
                        page:$scope.page, 
                        count: $scope.count 
                    }
                }).then(function(res){
                	if (res.data.resultCode == '0000') {
                		console.log(res);
                		$scope.countAll =  res.data.result.count;
                		$scope.recordData = res.data.result.list;
                	}else{
                		alert(res.data.resultMsg);
                	}
                })
            }
        }
        record.init();
    }
])
